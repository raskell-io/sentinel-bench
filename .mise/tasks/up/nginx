#!/usr/bin/env bash
#MISE description="Start Nginx"

set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
ROOT_DIR="$(cd "$SCRIPT_DIR/../../.." && pwd)"

echo "Starting Nginx..."
podman compose -f "$ROOT_DIR/docker/docker-compose.yaml" --profile nginx up -d

echo "Waiting for Nginx to be ready..."
for i in {1..30}; do
    if curl -sf http://localhost:8080/ >/dev/null 2>&1; then
        echo "Nginx is ready!"
        exit 0
    fi
    sleep 1
done

echo "Warning: Nginx may not be fully ready"
