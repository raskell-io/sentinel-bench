#!/usr/bin/env bash
#MISE description="Benchmark HAProxy (starts, benchmarks, stops)"
#MISE depends=["up:haproxy"]

set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
ROOT_DIR="$(cd "$SCRIPT_DIR/../../.." && pwd)"

SCENARIO="${1:-passthrough}"

# Run the main benchmark script
"$SCRIPT_DIR/../bench-main" haproxy "$SCENARIO" "${@:2}"

# Stop after benchmark
echo "Stopping HAProxy..."
docker compose -f "$ROOT_DIR/docker/docker-compose.yaml" --profile haproxy down
